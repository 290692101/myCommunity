<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bbs.dao.UserMapper">
    <!--用户类的映射配置文件-->
    <!--来一个resultMap建立映射-->
    <resultMap id="userMap" type="User">
        <id property="id" column="id"/>
        <id property="username" column="user_name"/>
        <id property="password" column="password"/>
        <id property="email" column="email"/>
        <id property="type" column="type"/>
        <id property="status" column="status"/>
        <id property="credit" column="credit"/>
        <id property="createTime" column="create_time"/>
    </resultMap>
    <!--可重用的sql语句们-->
    <sql id = "selectFields">
        id, user_name, password, email, type, status, credit, create_time
    </sql>

    <sql id = "insertFields">
        user_name, password, email, type, status, credit, create_time
    </sql>
    <!--查-->
    <select id="selectUserByUsername" resultMap="userMap">
        select <include refid="selectFields"></include>
        from user_bbs
        where user_name=#{username}

    </select>



    <!--增-->
    <insert id="insertUser" parameterType="User" keyProperty="id" >
        insert into user_bbs (<include refid="insertFields"></include>)
        values (#{username},#{password},#{email},#{type},#{status},#{credit},#{createTime})
        <!--获取新插入的对象的主键 并映射到新插入的对象的id中-->
        <selectKey keyColumn="id" resultType="int" keyProperty="id" order="AFTER">
            select LAST_INSERT_ID()
        </selectKey>

    </insert>

    <!--改-->
    <update id="updateUserCredit">
        update user_bbs
        set credit=credit+#{addValue}
        where id=#{userId}
    </update>

    <!--改-->
    <update id="updateUserByMap">
        update user_bbs
        set
        <foreach collection="_parameter" item="val" index="key" separator=",">
            ${key}=#{val}
        </foreach>
        <!--保证map里一定有id且有效-->
        where id=#{id}
    </update>


</mapper>